<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport" >
    <meta content="In this post, I would like to share interesting insights about recursion support in DMN and highlights how specific properties of the FEEL language enable functional programming constructs to be ..." name="description"> 
    <title>Functional Programming in DMN: it FEELs like recursing my university studies again</title>
    <link rel="canonical" href="https://blog.kie.org/2020/04/functional-programming-in-dmn-it-feels-like-recursing-my-university-studies-again.html" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
.blog-header {
  font-family: "Playfair Display", Georgia, "Times New Roman", serif/*rtl:Amiri, Georgia, "Times New Roman", serif*/;
}
    </style>
</head>
<body>	
<header>
  <div class="navbar navbar-dark bg-dark shadow-lg">
    <div class="container">
      <a href="https://matteomortari.com" class="navbar-brand d-flex align-items-center">
        <strong>matteomortari.com</strong>
      </a>
    </div>
  </div>
</header>

<main><section class="my-2 py-5 container">
	<div class="page-header">
		<h1 class="blog-header">Functional Programming in DMN: it FEELs like recursing my university studies again</h1>
	</div>

	<p><em>14 April 2020</em></p>

	In this post, I would like to share interesting insights about recursion support in DMN and highlights how specific properties of the FEEL language enable functional programming constructs to be modeled in DMN.<br /><br />We are going to start from a basic example, in order to demonstrate how the Business Friendliness nature of the FEEL language and DMN constructs, allow us to tame an otherwise commonly unpleasant problem: the definition of a recursive function. Then, we are going to adventure in FP land, and in the cradle of FEEL/DMN we will admire one of the best creatures of functional construct: the Y Combinator. At the end, we will find ourselves be asked the famous question again:<br /><div style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-Ovsb3rRsdLY/XpV4DzewakI/AAAAAAAAcsA/meKW5eMVQuw4lS3-PsfpI-LKNBzBzRxiQCNcBGAsYHQ/s1600/image4.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="609" data-original-width="1125" height="173" src="https://1.bp.blogspot.com/-Ovsb3rRsdLY/XpV4DzewakI/AAAAAAAAcsA/meKW5eMVQuw4lS3-PsfpI-LKNBzBzRxiQCNcBGAsYHQ/s320/image4.png" width="320" /></a></div><br />Using the pure engineering approach, let’s dig into the matter right away!<br /><br /><div><h2>Basic recursion example</h2><div><br /></div>The <a href="https://drools.org/learn/dmn.html" target="_blank" rel="noopener noreferrer">Drools DMN open source engine</a> allows recursion support in DMN Business Knowledge Model nodes. This enables modeling of recursive functions very easily and <b>it is our recommended approach</b> when modeling recursive functions in DMN: allow the function to call itself by its name.<br /><br />Let’s take a look at a simple example: modeling the <a href="https://en.wikipedia.org/wiki/Factorial" target="_blank" rel="noopener noreferrer">factorial</a> function in DMN.<br /><br />We can use the <a href="https://porcelli.me/announcement/tooling/online/bpmn/dmn/2020/03/12/online-new-editors.html" target="_blank" rel="noopener noreferrer">Kogito DMN editor</a> and define the DRD as follows:<a href="https://1.bp.blogspot.com/-DtC2-_Svfkw/XpV5G5BF9KI/AAAAAAAAcsI/81lgASeZ3a4OYnYMyVHF0ewCxVH-HeGfwCNcBGAsYHQ/s1600/image3.png" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" data-original-height="868" data-original-width="1201" height="462" src="https://1.bp.blogspot.com/-DtC2-_Svfkw/XpV5G5BF9KI/AAAAAAAAcsI/81lgASeZ3a4OYnYMyVHF0ewCxVH-HeGfwCNcBGAsYHQ/s640/image3.png" width="640" /></a><br /><br /><br />With the “fac” Business Knowledge Model (in short, BKM) node defining the actual Factorial function recursively as:<br /><div style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-7Ot9dJRr7mw/XpV5lx6wYLI/AAAAAAAAcsQ/tLPW-S0ZtiIRp5Jvqd3YQykPIHiTIuZEwCNcBGAsYHQ/s1600/image9.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="326" data-original-width="532" height="392" src="https://1.bp.blogspot.com/-7Ot9dJRr7mw/XpV5lx6wYLI/AAAAAAAAcsQ/tLPW-S0ZtiIRp5Jvqd3YQykPIHiTIuZEwCNcBGAsYHQ/s640/image9.png" width="640" /></a></div><br /><br />As we can notice, the function invokes itself as any other normal <a href="https://www.google.com/search?q=recursion" target="_blank" rel="noopener noreferrer">recursive</a> function, the only difference here is that it is defined as part of a DMN Boxed Expression; the name of this function is defined by the BKM node with the boxed expression construct “fac”, then the body of the function make reference and invokes itself as part of the FEEL expression “fac(n-1)”.<br /><br />We can use this BKM to calculate the actual result as passed by the Input Data node, as part of the “compute factorial” Decision, as:<br /><div style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-RcPiU8L7Qug/XpV5sA1ZRVI/AAAAAAAAcsU/E08ZZwqCmyMeMaPVB3siTggs-1bYrYbbACNcBGAsYHQ/s1600/image2.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="330" data-original-width="564" height="374" src="https://1.bp.blogspot.com/-RcPiU8L7Qug/XpV5sA1ZRVI/AAAAAAAAcsU/E08ZZwqCmyMeMaPVB3siTggs-1bYrYbbACNcBGAsYHQ/s640/image2.png" width="640" /></a></div><br /><br />This works well and gives the expected results:<br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">{</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; My number: 3</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; fac: function fac( n )</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; compute factorial: 6</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">}</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span><br /><h2><span style="font-family: inherit;">About currying</span></h2><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">DMN and more importantly the FEEL language allow to define and invoke <a href="https://en.wikipedia.org/wiki/Currying#Contrast_with_partial_function_application" target="_blank" rel="noopener noreferrer">curried</a> functions.</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">This allows us to write in FEEL something like:</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">{ f : function(a) function(b) a + b, r : f(1)(2) }</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">where:</span><br /><br /><ul><li><span style="font-family: inherit;">we defined a feel:context with 2 entries</span></li><li><span style="font-family: inherit;">the first entry is named “f” and defines a curried function: a function of one parameter “a” that, once invoked, will return a function of one parameter “b” that, once invoked, will return the sum of a+b</span></li><li><span style="font-family: inherit;">the latter entry named “r” which invokes the curried function with a=1 and b=2.</span></li></ul><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">Albeit this is potentially a weird looking FEEL expression, we are not surprised once executed r = 3.</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">We can do equivalently by using DMN Boxed Expression constructs:</span><br /><span style="font-family: inherit;"><br /></span><br /><div style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-te_EmOZpMpA/XpV6_aZ6XRI/AAAAAAAAcsk/WPRoN2lB6-8dL1fEADyEuwsAGzOumku9gCNcBGAsYHQ/s1600/image7.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="629" data-original-width="918" height="438" src="https://1.bp.blogspot.com/-te_EmOZpMpA/XpV6_aZ6XRI/AAAAAAAAcsk/WPRoN2lB6-8dL1fEADyEuwsAGzOumku9gCNcBGAsYHQ/s640/image7.png" width="640" /></a></div><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">This is a BKM node named “curried sum”; it is a DMN Invocable of one parameter “a” that, once invoked, will return a function of one parameter “b” that, once invoked, returns the sum of a+b.</span><br /><span style="font-family: inherit;">Again, we are not surprised once executed&nbsp;</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">curried sum(1)(2) = 3</span><br /><span style="font-family: inherit;"><br /></span><br /><h2><span style="font-family: inherit;">Y Combinator: recursion without recursion support</span></h2><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">Let’s go back for a moment to the earlier recursive function example; we overlooked the fact if it’s actually formally possible for a function to call itself by its name in DMN: the DMN specification does not explicitly support this, but it doesn’t explicitly forbid it either. In other terms, recursion support is not formally specified.</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">What-if we still needed to define a recursive function, but we found the road was still under construction, missing that formal recursion support? We can use a functional device, called the “<a href="https://youtu.be/9T8A89jgeTI" target="_blank" rel="noopener noreferrer">Y Combinator</a>” which allows anonymous functions to achieve recursion without relying on self-invocation by its own (unexisting) name.</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">Let’s look at an example; we can define the Y Combinator in DMN as follows:</span><br /><span style="font-family: inherit;"><br /></span><br /><div style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-w8ACy3InpEY/XpV7-mjlEKI/AAAAAAAAcs0/J52_N9IuXSMRwWfe9tnQVCUcIP3YCavJQCNcBGAsYHQ/s1600/image1.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="629" data-original-width="918" height="438" src="https://1.bp.blogspot.com/-w8ACy3InpEY/XpV7-mjlEKI/AAAAAAAAcs0/J52_N9IuXSMRwWfe9tnQVCUcIP3YCavJQCNcBGAsYHQ/s640/image1.png" width="640" /></a></div><br /><span style="font-family: inherit;">It is potentially a weird looking function :) let’s assume this was defined for us, and we can just make use of it.&nbsp;</span><br /><span style="font-family: inherit;">We can use it to re-define the factorial calculation as:</span><br /><span style="font-family: inherit;"><br /></span><div style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-wnZ5nkrZNos/XpV7PdWwmFI/AAAAAAAAcsw/nGSdAkHRTJ4RIzT3z1Af3T2GtqJzkxcaQCPcBGAYYCw/s1600/image5.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="629" data-original-width="918" height="438" src="https://1.bp.blogspot.com/-wnZ5nkrZNos/XpV7PdWwmFI/AAAAAAAAcsw/nGSdAkHRTJ4RIzT3z1Af3T2GtqJzkxcaQCPcBGAYYCw/s640/image5.png" width="640" /></a></div><br /><span style="font-family: inherit;">We can notice the body of the “fac” function definition is overall the same; however, this is not any longer a function invoking itself by its name: there is no trace of a call to “fac(...)” in the body of the function!</span><br /><span style="font-family: inherit;">Naturally, there is still a form of recursion happening, but this time is leveraging the name of the parameters which are in scope of the closure: “f”.&nbsp;</span><br /><span style="font-family: inherit;">The result works as expected:</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">fac(3) = 6</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">We can take a look at another example, defining the Fibonacci sequence using the Y Combinator in DMN:</span><br /><span style="font-family: inherit;"><br /></span><br /><div style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-9ZLCCXNYF1A/XpV8JcTgGFI/AAAAAAAAcs4/1ZkteeJJ2sUYWfAeev6YbtkkgznE81T4ACNcBGAsYHQ/s1600/image8.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="629" data-original-width="918" height="438" src="https://1.bp.blogspot.com/-9ZLCCXNYF1A/XpV8JcTgGFI/AAAAAAAAcs4/1ZkteeJJ2sUYWfAeev6YbtkkgznE81T4ACNcBGAsYHQ/s640/image8.png" width="640" /></a></div><br /><span style="font-family: inherit;">We notice again there is no call to “fib(...)” in the function body, yet recursion for the calculation of the Fibonacci sequence is performed thanks to the use of the Y Combinator.</span><br /><span style="font-family: inherit;">Once again, the result works as expected:</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">fib(5) = [1, 1, 2, 3, 5]</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">For extra fun, we can re-define the Y Combinator using where possible the DMN Boxed Expression forms. This is an interesting exercise to see how closures are applied in their boxed variant. The Y Combinator definition could be refactored as:</span><br /><span style="font-family: inherit;"><br /></span><br /><div style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-Fs6H16uviFE/XpV83HIwjuI/AAAAAAAActE/amoqRBw8IlcHnD-zAqTSK_Sp5yklUe0VQCNcBGAsYHQ/s1600/image6.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="895" data-original-width="978" height="584" src="https://1.bp.blogspot.com/-Fs6H16uviFE/XpV83HIwjuI/AAAAAAAActE/amoqRBw8IlcHnD-zAqTSK_Sp5yklUe0VQCNcBGAsYHQ/s640/image6.png" width="640" /></a></div><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">and that would yield again the same expected and correct results.</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">For (extra (extra fun)), we can re-define once more the Y Combinator in a single FEEL expression to calculate for instance the factorial of 4:</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">{ Y: function(f) (function(x) x(x))(function(y) f(function(x) y(y)(x))), fac: Y(function(f) function(n) if n &gt; 1 then n * f(n-1) else 1), fac4: fac(4) }.fac4</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">The result is unsurprisingly: 24.</span><br /><span style="font-family: inherit;"><br /></span><br /><h2><span style="font-family: inherit;">Conclusion</span></h2><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">In this post, we have seen a basic example of recursion in DMN, and how to leverage recursion support in the engine is very simple to use; <b>engine recursion support is the approach we recommend</b> to achieve recursion DMN: give the function a name, and in the body of the function make use of that name to invoke itself. In the example, we have named the function “fac”, then we invoked “fac(...)” in the body of the function itself.</span><br /><span style="font-family: inherit;">This approach is very practical, easy to model in DMN and works just fine.</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">We have also seen how DMN and FEEL do indeed support curried function definition and invocation. FEEL is (also) a functional language; all these properties allow us to define in DMN and use the Y Combinator, a functional device to achieve recursion without recursion support!</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">I personally found these exercises very interesting to apply functional programming concepts in DMN, while at the same time making sure the engine worked as expected. I would like to say special thanks to my colleagues Edoardo Vacchi and Luca Molteni for their support while discussing the Y Combinator and Currying functions.&nbsp;</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">Interested in DMN?</span><br /><span style="font-family: inherit;">If you didn’t know about DMN before, you found this post interesting but looking for a gentle introduction to the DMN standard, we have just the right crash course on DMN, freely available for you at:</span><br /><span style="font-family: inherit;"><a href="http://learn-dmn-in-15-minutes.com/">http://learn-dmn-in-15-minutes.com</a>&nbsp;</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: inherit;">You can find additional information on the Drools website </span><a href="https://drools.org/learn/dmn.html" style="font-family: inherit;" target="_blank" rel="noopener noreferrer">here</a><span style="font-family: inherit;">. Don’t hesitate to contact us for more information.</span><br /><div><br /></div><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span></div><div><br /></div>


</section>
</main>

<footer class="text-muted py-5">
  <div class="container">
    <p class="float-end mb-1">
      <a href="#">Back to top</a>
    </p>
    <p>&copy; Matteo Mortari. All rights reserved
      <br/><a href="https://www.linkedin.com/in/matteomortari" class="text-reset">LinkedIn</a>
      <br/><a href="https://www.youtube.com/MatteoMortari" class="text-reset">YouTube</a>
      <br/><a href="https://github.com/tarilabs" class="text-reset">Github</a>
      <!-- <br/><a href="https://twitter.com/tari_manga" class="text-reset">Twitter</a> -->
    </p>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>

  </body>
</html>